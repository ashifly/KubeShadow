package exploitation

import (
	"fmt"

	"github.com/spf13/cobra"
)

// ExploitationCmd represents the main exploitation command
var ExploitationCmd = &cobra.Command{
	Use:   "exploitation",
	Short: "KubeShadow Exploitation Framework - Metasploit-style modules",
	Long: `KubeShadow Exploitation Framework

A comprehensive exploitation framework similar to Metasploit, providing:
- Payload generation and injection
- Privilege escalation exploits
- Container escape techniques
- Lateral movement tools
- Persistence mechanisms
- Post-exploitation modules
- Cloud-specific exploitation

Available Categories:
  payloads        - Generate and inject malicious payloads
  exploits        - Execute specific exploits against targets
  persistence     - Establish persistent access
  post-ex         - Post-exploitation and data collection
  evasion         - Evasion and stealth techniques
  cloud-exploits  - Cloud-specific exploitation techniques

Examples:
  kubeshadow exploitation payloads list
  kubeshadow exploitation exploits rbac-escalate --target-pod vulnerable-pod
  kubeshadow exploitation persistence backdoor --method sidecar
  kubeshadow exploitation post-ex data-collect --output /tmp/loot
  kubeshadow exploitation cloud-exploits aws-iam-escalate --target-role my-role`,
	RunE: runExploitation,
}

func runExploitation(cmd *cobra.Command, args []string) error {
	fmt.Println("ðŸŽ¯ KubeShadow Exploitation Framework")
	fmt.Println("====================================")
	fmt.Println("")
	fmt.Println("Available Categories:")
	fmt.Println("  payloads        - Generate and inject malicious payloads")
	fmt.Println("  exploits        - Execute specific exploits against targets")
	fmt.Println("  persistence     - Establish persistent access")
	fmt.Println("  post-ex         - Post-exploitation and data collection")
	fmt.Println("  evasion         - Evasion and stealth techniques")
	fmt.Println("  cloud-exploits  - Cloud-specific exploitation techniques")
	fmt.Println("")
	fmt.Println("Use 'kubeshadow exploitation [category] --help' for more information")
	return nil
}

func init() {
	// Add subcommands
	ExploitationCmd.AddCommand(PayloadsCmd)
	ExploitationCmd.AddCommand(ExploitsCmd)
	ExploitationCmd.AddCommand(PersistenceCmd)
	ExploitationCmd.AddCommand(PostExCmd)
	ExploitationCmd.AddCommand(EvasionCmd)
	ExploitationCmd.AddCommand(CloudExploitsCmd)
	ExploitationCmd.AddCommand(EphemeralCmd)
	ExploitationCmd.AddCommand(InitContainerCmd)
	ExploitationCmd.AddCommand(CVEExploitsCmd)
	ExploitationCmd.AddCommand(LoadBalancerCmd)
}
